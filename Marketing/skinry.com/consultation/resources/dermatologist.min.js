var email;$(function(){var b="BiixOUv8TBRRCc9PnScmyF2XMHRZhx2LfmvdqtvA";var a="Sj5Vw02dRs3zI59caHeMQCEB9EXrNcsKPe0xkczc";Parse.initialize(b,a);$("#short-form").submit(function(c){c.preventDefault();submit("short",collectShort());return false});$("#full-form").submit(function(c){c.preventDefault();submit("full",collectFull());return false});$("#sendButton").click(function(){var c=$("#qtype").children(".active").children().attr("id");if(c=="qshort"){$("#short-form").find(".sendBtn").click()}else{if(c=="qfull"){$("#full-form").find(".sendBtn").click()}}})});function getParameterByName(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c=new RegExp("[\\?&]"+a+"=([^&#]*)"),b=c.exec(location.search);return b==null?"":decodeURIComponent(b[1].replace(/\+/g," "))}function collectShort(){return{name:$("#short-name").val(),email:$("#short-email").val(),sex:$("#short-sex").val(),age:$("#short-age").val(),complaint:$("#short-complaint").val(),allergy:$("#short-allergy").val(),previous:$("#short-previous").val()}}function collectFull(){return{name:$("#full-name").val(),email:$("#full-email").val(),sex:$("#full-sex").val(),day:$("#full-day").val(),month:$("#full-month").val(),year:$("#full-year").val(),starttime:$("#full-starttime").val(),cause:$("#full-cause").val(),drugs:$("#full-drugs").val(),whatworks:$("#full-whatworks").val(),allergy:$("#full-allergy").val(),illness:$("#full-illness").val(),illnessdrugs:$("#full-illnessdrugs").val(),legacy:$("#full-legacy").val()}}function collectPhotos(){var a=[];$("#photolist").find("tbody").children().each(function(){var b=$(this).children()[1];var c={path:$(b).children(".upl-hidden").text(),description:$(b).children(".upl-description").val()};a.push(c)});return a}function submit(c,a){var b=Parse.Object.extend("Dermatologist");var d=new Parse.Query(b);d.equalTo("email",a.email);d.find({success:function(e){if(e.length==0){a.photos=collectPhotos();console.log(a);send(c,a)}else{$("#not-unique-modal").modal("show")}},error:function(e){alert("Error: "+e.code+" "+e.message)}})}function send(c,a){var b=Parse.Object.extend("Dermatologist");var d=new b();d.set("email",a.email);d.set("type",c);d.set("questionary",JSON.stringify(a));d.save().then(function(){window.location.replace("./success.html?email="+a.email)})}function sendVK(){var a=Parse.Object.extend("Dermatologist");var b=new Parse.Query(a);b.equalTo("email",email);b.find({success:function(c){if(c.length>0){c[0].set("vk",$("#vkid").val());c[0].save().then(function(){$("#vk-form").html("<h4>Спасибо!</h4>")})}else{alert("Такой email не найден")}},error:function(c){alert("Error: "+c.code+" "+c.message)}})}function addrow(){var c=$("#photolist");c.append('<tr><td style="width: 130px"><div style="height: 120px; width: 120px; background-color: #eee"><img class="upl-preview" style="max-height: 120px; max-width: 120px"></td><td><div class="upl-progress progress active" style="margin-top: 15px"><div class="upl-bar progress-bar" role="progressbar" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100" style="width: 0; text-align: center">0%</div></div><div class="upl-status" style="margin-top: 0; margin-bottom: 0"></div><div class="upl-hidden" style="display: none"></div><textarea class="upl-description form-control" style="margin-top: 7px" placeholder="Описание фото"></textarea></td><td style="width: 25px"><a href="#">x</a><form class="upl-form" action="upload.php" enctype="multipart/form-data" method="post"><input class="upl-image" type="file" name="image" style="display: none"></form></td></tr>');$(".upl-image:last").change(function(){if(this.files&&this.files[0]){var d=new FileReader();d.readAsDataURL(this.files[0]);d.onload=function(e){$(".upl-preview:last").attr("src",e.target.result)};$(".upl-form:last").submit();$(".panel-footer a").text("Приложить еще фото")}});c.find("a:last").click(function(){$(this).closest("tr").remove();return false});var a=$(".upl-status:last");var b=$(".upl-bar:last");$(".upl-form:last").ajaxForm({dataType:"json",beforeSend:function(){a.fadeOut();b.width("0%");b.text("0%")},uploadProgress:function(g,d,f,e){var h=e+"%";b.width(h);b.text(h)},complete:function(d){$(".upl-progress:last").hide();if(d.responseJSON.type=="SUCCESS"){$(".upl-hidden:last").text(d.responseJSON.path);a.addClass("bs-callout bs-callout-info");setTimeout(function(){a.fadeOut()},2000)}else{a.addClass("bs-callout bs-callout-danger");$(".upl-description:last").hide()}a.html(d.responseJSON.status).fadeIn()}});$(".upl-image:last").click()};